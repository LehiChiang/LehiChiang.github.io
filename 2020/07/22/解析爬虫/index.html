

<!DOCTYPE html>
<html lang="zh-CN" data-default-color-scheme=&#34;auto&#34;>



<head>
  <meta charset="UTF-8">
  <link rel="apple-touch-icon" sizes="76x76" href="/img/icon-small-black.png">
  <link rel="icon" type="image/png" href="/img/icon-small-black.png">
  <meta name="viewport"
        content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, shrink-to-fit=no">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  
  <meta name="theme-color" content="#2f4154">
  <meta name="description" content="Lehi J.">
  <meta name="author" content="Lehi Chiang">
  <meta name="keywords" content="AI,Java,Python">
  <title>解析爬虫 - Lehi J.</title>

  <link  rel="stylesheet" href="https://cdn.staticfile.org/twitter-bootstrap/4.4.1/css/bootstrap.min.css" />


  <link  rel="stylesheet" href="https://cdn.staticfile.org/github-markdown-css/4.0.0/github-markdown.min.css" />
  <link  rel="stylesheet" href="/lib/hint/hint.min.css" />

  
    
    
      
      <link  rel="stylesheet" href="https://cdn.staticfile.org/highlight.js/10.0.0/styles/gruvbox-dark.min.css" />
    
  

  


<!-- 主题依赖的图标库，不要自行修改 -->

<link rel="stylesheet" href="//at.alicdn.com/t/font_1749284_pf9vaxs7x7b.css">



<link rel="stylesheet" href="//at.alicdn.com/t/font_1736178_kmeydafke9r.css">


<link  rel="stylesheet" href="/css/main.css" />

<!-- 自定义样式保持在最底部 -->


  <script  src="/js/utils.js" ></script>
  <script  src="/js/color-schema.js" ></script>
<meta name="generator" content="Hexo 4.2.1"><link rel="alternate" href="/atom.xml" title="Lehi J." type="application/atom+xml">
</head>


<body>
  <header style="height: 70vh;">
    <nav id="navbar" class="navbar fixed-top  navbar-expand-lg navbar-dark scrolling-navbar">
  <div class="container">
    <a class="navbar-brand"
       href="/">&nbsp;<strong>Lehi J.</strong>&nbsp;</a>

    <button id="navbar-toggler-btn" class="navbar-toggler" type="button" data-toggle="collapse"
            data-target="#navbarSupportedContent"
            aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
      <div class="animated-icon"><span></span><span></span><span></span></div>
    </button>

    <!-- Collapsible content -->
    <div class="collapse navbar-collapse" id="navbarSupportedContent">
      <ul class="navbar-nav ml-auto text-center">
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/">
                <i class="iconfont icon-home-fill"></i>
                首页
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/archives/">
                <i class="iconfont icon-archive-fill"></i>
                归档
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/categories/">
                <i class="iconfont icon-category-fill"></i>
                分类
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/tags/">
                <i class="iconfont icon-tags-fill"></i>
                标签
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/about/">
                <i class="iconfont icon-user-fill"></i>
                关于
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/links/">
                <i class="iconfont icon-link-fill"></i>
                友链
              </a>
            </li>
          
        
        
          <li class="nav-item" id="search-btn">
            <a class="nav-link" data-toggle="modal" data-target="#modalSearch">&nbsp;<i
                class="iconfont icon-search"></i>&nbsp;</a>
          </li>
        
        
          <li class="nav-item" id="color-toggle-btn">
            <a class="nav-link" href="javascript:">&nbsp;<i
                class="iconfont icon-dark" id="color-toggle-icon"></i>&nbsp;</a>
          </li>
        
      </ul>
    </div>
  </div>
</nav>

    <div class="banner intro-2" id="background" parallax=true
         style="background: url('/img/pass_img/python_bg.jpg') no-repeat center center;
           background-size: cover;">
      <div class="full-bg-img">
        <div class="mask flex-center" style="background-color: rgba(0, 0, 0, 0.3)">
          <div class="container page-header text-center fade-in-up">
            <span class="h2" id="subtitle">
              
            </span>

            
              <div class="mt-3">
  
    <span class="post-meta mr-2">
      <i class="iconfont icon-author" aria-hidden="true"></i>
      Lehi Chiang
    </span>
  
  
    <span class="post-meta">
      <i class="iconfont icon-date-fill" aria-hidden="true"></i>
      <time datetime="2020-07-22 15:35" pubdate>
        2020年7月22日 下午
      </time>
    </span>
  
</div>

<div class="mt-1">
  
    
    <span class="post-meta mr-2">
      <i class="iconfont icon-chart"></i>
      5.8k 字
    </span>
  

  
    
    <span class="post-meta mr-2">
      <i class="iconfont icon-clock-fill"></i>
      
      
      80
       分钟
    </span>
  

  
  
    
      <!-- 不蒜子统计文章PV -->
      <span id="busuanzi_container_page_pv" style="display: none">
        <i class="iconfont icon-eye" aria-hidden="true"></i>
        <span id="busuanzi_value_page_pv"></span> 次
      </span>
    
  
</div>

            
          </div>

          
        </div>
      </div>
    </div>
  </header>

  <main>
    
      

<div class="container-fluid">
  <div class="row">
    <div class="d-none d-lg-block col-lg-2"></div>
    <div class="col-lg-8 nopadding-md">
      <div class="container nopadding-md" id="board-ctn">
        <div class="py-5" id="board">
          <article class="post-content mx-auto" id="post">
            <!-- SEO header -->
            <h1 style="display: none">Python网络爬虫基础知识</h1>
            
            <div class="markdown-body" id="post-body">
              <h2 id="（一）发起HTTP-HTTPS请求"><a href="#（一）发起HTTP-HTTPS请求" class="headerlink" title="（一）发起HTTP/HTTPS请求"></a>（一）发起HTTP/HTTPS请求</h2><h3 id="一：方法一：urllib"><a href="#一：方法一：urllib" class="headerlink" title="一：方法一：urllib"></a>一：方法一：urllib</h3><p>​    urllib是python内置的HTTP请求库，无需安装即可使用，它包含了4个模块：</p>
<ul>
<li><p>request：它是最基本的http请求模块，用来模拟发送请求</p>
</li>
<li><p>error：异常处理模块，如果出现错误可以捕获这些异常</p>
</li>
<li><p>parse：一个工具模块，提供了许多URL处理方法，如：拆分、解析、合并等</p>
</li>
<li><p>robotparser：主要用来识别网站的robots.txt文件，然后判断哪些网站可以爬</p>
<p><strong>快速爬取一个网页</strong></p>
<div class="hljs"><pre><code class="hljs python"><span class="hljs-keyword">import</span> urllib.request <span class="hljs-keyword">as</span> ur
response=ur.urlopen(<span class="hljs-string">"https://www.baidu.com"</span>)
html=response.read().decode(<span class="hljs-string">"utf-8"</span>)
print(html)</code></pre></div>

<div class="hljs"><pre><code class="hljs html"><span class="hljs-tag">&lt;<span class="hljs-name">html</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">head</span>&gt;</span>
	<span class="hljs-tag">&lt;<span class="hljs-name">script</span>&gt;</span>
<span class="actionscript">		location.replace(location.href.replace(<span class="hljs-string">"https://"</span>,<span class="hljs-string">"http://"</span>));</span>
	<span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">head</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">body</span>&gt;</span>
	<span class="hljs-tag">&lt;<span class="hljs-name">noscript</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">meta</span> <span class="hljs-attr">http-equiv</span>=<span class="hljs-string">"refresh"</span> <span class="hljs-attr">content</span>=<span class="hljs-string">"0;url=http://www.baidu.com/"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">noscript</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">body</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">html</span>&gt;</span></code></pre></div>

</li>
</ul>
<h4 id="1、urllib-request-urlopen"><a href="#1、urllib-request-urlopen" class="headerlink" title="1、urllib.request.urlopen()"></a>1、urllib.request.urlopen()</h4><p>urllib.request.urlopen(<strong>url,data=None,[timeout,</strong>],cafile=None,capath=None,cadefault=False,context=None)</p>
<p>urlopen()方法可传递参数：</p>
<p><strong>url：</strong>网站地址，str类型，<strong><u><em>也可以是一个request对象</em></u></strong></p>
<p><strong>data：</strong>data参数是可选的，内容为字节流编码格式的即bytes类型，如果传递data参数，urlopen将使用Post方式请求</p>
<div class="hljs"><pre><code class="hljs python"><span class="hljs-keyword">from</span> urllib.request <span class="hljs-keyword">import</span> urlopen
<span class="hljs-keyword">import</span> urllib.parse

data = bytes(urllib.parse.urlencode(&#123;<span class="hljs-string">'word'</span>:<span class="hljs-string">'hello'</span>&#125;),encoding=<span class="hljs-string">'utf-8'</span>) <span class="hljs-comment">#data需要字节类型的参数，使用bytes()函数转换为字节，使用urllib.parse模块里的urlencode()方法来讲参数字典转换为字符串并指定编码</span>
response = urlopen(<span class="hljs-string">'http://httpbin.org/post'</span>,data=data)
print(response.read())</code></pre></div>

<div class="hljs"><pre><code class="hljs python"><span class="hljs-comment">#output</span>
<span class="hljs-string">b'&#123;</span>
<span class="hljs-string">........</span>
<span class="hljs-string">"form":&#123;"word":"hello"&#125;,  #form字段表明模拟以表单的方法提交数据，post方式传输数据</span>
<span class="hljs-string">"headers":&#123;"Accept-Encoding":"identity",</span>
<span class="hljs-string"> .......&#125;'</span></code></pre></div>

<p><strong>timeout参数：</strong>用于设置超时时间，单位为秒，如果请求超出了设置时间还未得到响应则抛出异常，支持HTTP,HTTPS,FTP请求</p>
<div class="hljs"><pre><code class="hljs python"><span class="hljs-keyword">import</span> urllib.request
response=urllib.request.urlopen(<span class="hljs-string">'http://httpbin.org/get'</span>,timeout=<span class="hljs-number">0.1</span>)  <span class="hljs-comment">#设置超时时间为0.1秒,将抛出异常</span>
print(response.read())</code></pre></div>

<div class="hljs"><pre><code class="hljs python"><span class="hljs-comment">#output</span>
urllib.error.URLError: &lt;urlopen error timed out&gt;</code></pre></div>

<p>可以使用异常处理来捕获异常</p>
<div class="hljs"><pre><code class="hljs python"><span class="hljs-keyword">import</span> urllib.request
<span class="hljs-keyword">import</span> urllib.error
<span class="hljs-keyword">import</span> socket
<span class="hljs-keyword">try</span>:
    response=urllib.request.urlopen(<span class="hljs-string">'http://httpbin.org/get'</span>,timeout=<span class="hljs-number">0.1</span>)
    print(response.read())
<span class="hljs-keyword">except</span> urllib.error.URLError <span class="hljs-keyword">as</span> e:
    <span class="hljs-keyword">if</span> isinstance(e.reason,socket.timeout): <span class="hljs-comment">#判断对象是否为类的实例</span>
        print(e.reason) <span class="hljs-comment">#返回错误信息</span></code></pre></div>

<div class="hljs"><pre><code class="hljs python"><span class="hljs-comment">#output</span>
timed out</code></pre></div>

<p>其他参数：context参数，她必须是ssl.SSLContext类型，用来指定SSL设置，此外,cafile和capath这两个参数分别指定CA证书和它的路径，会在https链接时用到。</p>
<h4 id="2-返回HTTPResponse对象"><a href="#2-返回HTTPResponse对象" class="headerlink" title="2.返回HTTPResponse对象"></a>2.返回HTTPResponse对象</h4><p>urlopen()方法返回一个HTTPResponse类型的对象，该对象包含的方法和属性：</p>
<p>方法：read()、readinto()、getheader(name)、getheaders()、fileno()</p>
<p>属性：msg、version、status、reason、bebuglevel、closed</p>
<div class="hljs"><pre><code class="hljs python"><span class="hljs-keyword">import</span> urllib.request

response=urllib.request.urlopen(<span class="hljs-string">'https://www.python.org'</span>)  <span class="hljs-comment">#请求站点获得一个HTTPResponse对象</span>
print(response.read().decode(<span class="hljs-string">'utf-8'</span>))   <span class="hljs-comment">#返回网页内容</span>
print(response.getheader(<span class="hljs-string">'server'</span>)) <span class="hljs-comment">#返回响应头中的server值</span>
print(response.getheaders()) <span class="hljs-comment">#以列表元祖对的形式返回响应头信息</span>
print(response.fileno()) <span class="hljs-comment">#返回文件描述符</span>
print(response.version)  <span class="hljs-comment">#返回版本信息</span>
print(response.status)  <span class="hljs-comment">#返回状态码200，404代表网页未找到</span>
print(response.debuglevel) <span class="hljs-comment">#返回调试等级</span>
print(response.closed)  <span class="hljs-comment">#返回对象是否关闭布尔值</span>
print(response.geturl()) <span class="hljs-comment">#返回检索的URL</span>
print(response.info()) <span class="hljs-comment">#返回网页的头信息</span>
print(response.getcode()) <span class="hljs-comment">#返回响应的HTTP状态码</span>
print(response.msg)  <span class="hljs-comment">#访问成功则返回ok</span>
print(response.reason) <span class="hljs-comment">#返回状态信息</span></code></pre></div>

<h4 id="3-构造Request对象"><a href="#3-构造Request对象" class="headerlink" title="3.构造Request对象"></a>3.构造Request对象</h4><p>如果希望执行更为复杂的操作（如增加HTTP报头），则必须创建一个Request()对象作为urlopen()的参数。</p>
<p>urllib.request.Request(<strong>url,data=None,headers={}</strong>,origin_req_host=None,unverifiable=False,method=None)</p>
<p>参数：</p>
<p><strong>url：</strong>请求的URL，必须传递的参数，其他都是可选参数</p>
<p><strong>data：</strong>上传的数据，必须传bytes字节流类型的数据，如果它是字典，可以先用urllib.parse模块里的urlencode()编码</p>
<p><strong>headers：</strong>它是一个字典，传递的是请求头数据，可以通过它构造请求头，也可以通过调用请求实例的方法add_header()来添加</p>
<p><em>例如：修改User_Agent头的值来伪装浏览器，比如火狐浏览器可以这样设置：</em></p>
<p><em>{‘User-Agent’:’Mozilla/5.0 (compatible; MSIE 5.5; Windows NT)’}</em></p>
<p>origin_req_host：指请求方的host名称或者IP地址</p>
<p>unverifiable：表示这个请求是否是无法验证的，默认为False，如我们请求一张图片如果没有权限获取图片那它的值就是true</p>
<p>method：是一个字符串，用来指示请求使用的方法，如：GET,POST,PUT等</p>
<div class="hljs"><pre><code class="hljs python"><span class="hljs-keyword">import</span> urllib.request
<span class="hljs-keyword">import</span> urllib.parse
url=<span class="hljs-string">'http://www.itcast.cn'</span>
header=&#123;<span class="hljs-string">"User-Agent"</span>:<span class="hljs-string">'Mozilla/5.0 (compatible; MSIE 5.5; Windows NT)'</span>&#125;
data=bytes(urllib.parse.urlencode(&#123;<span class="hljs-string">"name"</span>:<span class="hljs-string">"itcast"</span>&#125;).encode(<span class="hljs-string">'utf-8'</span>))
request=urllib.request.Request(url,headers=header,data=data)
response=urllib.request.urlopen(request)
print(response.read().decode(<span class="hljs-string">"utf-8"</span>))</code></pre></div>

<h4 id="4-如何发送get请求？"><a href="#4-如何发送get请求？" class="headerlink" title="4.如何发送get请求？"></a>4.如何发送get请求？</h4><p>如果使用urlopen()方法中的data属性发送的话属于POST请求，所有只能通过修改url的方式来发送GET请求，如:</p>
<div class="hljs"><pre><code class="hljs python">word=&#123;<span class="hljs-string">"wd"</span>:<span class="hljs-string">"itcast"</span>&#125;
word=urllib.parse.urlencode(word)
new_url=url+<span class="hljs-string">"?"</span>+word</code></pre></div>

<h4 id="5-添加特定Headers"><a href="#5-添加特定Headers" class="headerlink" title="5.添加特定Headers"></a>5.添加特定Headers</h4><p>可以调用request.add_header(“Connection”,”keep-alive”)</p>
<p>可以调用request.get_header(header_name=”Connection”)</p>
<h4 id="6-代理服务器"><a href="#6-代理服务器" class="headerlink" title="6.代理服务器"></a>6.代理服务器</h4><p> 之前的urlopen()方法就是urllib提供的一个opener， 它是urllib.request.OpenerDirector类的对象。但urlopen()方法不支持代理，Cookie等其他的HTTP/HTTPS高级功能。所有需要自定义一个Opener，需要执行以下几步：</p>
<ol>
<li>使用相关的Handler处理器创建特定功能的处理器对象</li>
<li>通过urllib.request.build_opener()方法创建自定义的opener对象</li>
<li>使用自定义的opener对象，调用open()方法发送请求</li>
</ol>
<p><strong><em>注意：如果想使用全局的opener发送请求的话，可以使用urllib2.install_opener()将自定义的opener对象定义为全局opener</em></strong></p>
<div class="hljs"><pre><code class="hljs python"><span class="hljs-keyword">import</span> urllib.request
http_handler = urllib.request.HTTPHandler()
opener = urllib.request.build_opener(http_handler)
request=urllib.request.Request(<span class="hljs-string">"http://itcast.cn"</span>)
response=opener.open(request)
print(response.read().decode(<span class="hljs-string">"utf-8"</span>))</code></pre></div>

<p>设置代理服务器</p>
<p>用户可以用urllib.request.ProxyHandler方法来设置代理服务器</p>
<div class="hljs"><pre><code class="hljs python"><span class="hljs-keyword">from</span> urllib.error <span class="hljs-keyword">import</span> URLError
<span class="hljs-keyword">from</span> urllib.request <span class="hljs-keyword">import</span> ProxyHandler,build_opener

proxy_handler=ProxyHandler(&#123;
    <span class="hljs-string">'http'</span>:<span class="hljs-string">'http://127.0.0.1:8888'</span>,
    <span class="hljs-string">'https'</span>:<span class="hljs-string">'http://127.0.0.1:9999'</span>
&#125;)
opener=build_opener(proxy_handler) <span class="hljs-comment">#构造一个Opener</span>
<span class="hljs-keyword">try</span>:
    response=opener.open(<span class="hljs-string">'https://www.baidu.com'</span>)
    print(response.read().decode(<span class="hljs-string">'utf-8'</span>))
<span class="hljs-keyword">except</span> URLError <span class="hljs-keyword">as</span> e:
    print(e.reason)</code></pre></div>

<p>提供几个免费的代理网站：</p>
<ol>
<li>西刺免费代理IP</li>
<li>快代理免费代理</li>
<li>Proxy360代理</li>
<li>全网代理IP</li>
</ol>
<p>获取网站的Cookies</p>
<div class="hljs"><pre><code class="hljs python"><span class="hljs-comment">#!/usr/bin/env python</span>
<span class="hljs-comment">#coding:utf8</span>
<span class="hljs-keyword">import</span> http.cookiejar,urllib.request
cookie=http.cookiejar.CookieJar() <span class="hljs-comment">#实例化cookiejar对象</span>
handler=urllib.request.HTTPCookieProcessor(cookie) <span class="hljs-comment">#构建一个handler</span>
opener=urllib.request.build_opener(handler) <span class="hljs-comment">#构建Opener</span>
response=opener.open(<span class="hljs-string">'http://www.baidu.com'</span>) <span class="hljs-comment">#请求</span>
print(cookie)
<span class="hljs-keyword">for</span> item <span class="hljs-keyword">in</span> cookie:
    print(item.name+<span class="hljs-string">"="</span>+item.value)</code></pre></div>

<h4 id="7-异常处理"><a href="#7-异常处理" class="headerlink" title="7.异常处理"></a>7.异常处理</h4><p>urllib的error模块定义了由request模块产生的异常，如果出现问题，request模块便会抛出error模块中定义的异常。</p>
<p>1）URLError</p>
<p>URLError类来自urllib库的error模块，它继承自OSError类，是error异常模块的基类，由request模块产生的异常都可以通过捕获这个类来处理，它只有一个属性reason，即返回错误的原因</p>
<div class="hljs"><pre><code class="hljs python"><span class="hljs-keyword">from</span> urllib <span class="hljs-keyword">import</span> request,error
<span class="hljs-keyword">try</span>:
    response=request.urlopen(<span class="hljs-string">'https://hehe,com/index'</span>)
<span class="hljs-keyword">except</span> error.URLError <span class="hljs-keyword">as</span> e:
    print(e.reason)  <span class="hljs-comment">#如果网页不存在不会抛出异常，而是返回捕获的异常错误的原因(Not Found)</span></code></pre></div>

<p> reason如超时则返回一个对象 </p>
<div class="hljs"><pre><code class="hljs python"><span class="hljs-keyword">import</span> socket
<span class="hljs-keyword">import</span> urllib.request
<span class="hljs-keyword">import</span> urllib.error
<span class="hljs-keyword">try</span>:
    response=urllib.request.urlopen(<span class="hljs-string">'https://www.baidu.com'</span>,timeout=<span class="hljs-number">0.001</span>)
<span class="hljs-keyword">except</span> urllib.error.URLError <span class="hljs-keyword">as</span> e:
    print(e.reason)
    <span class="hljs-keyword">if</span> isinstance(e.reason,socket.timeout):
        print(<span class="hljs-string">'time out'</span>)</code></pre></div>

<p>2）HTTPError</p>
<p>它是URLError的子类，专门用来处理HTTP请求错误，比如认证请求失败，它有3个属性：</p>
<p>code：返回HTTP的状态码，如404页面不存在，500服务器错误等</p>
<p>reason：同父类，返回错误的原因</p>
<p>headers：返回请求头</p>
<div class="hljs"><pre><code class="hljs python"><span class="hljs-keyword">from</span> urllib <span class="hljs-keyword">import</span> request,error
<span class="hljs-keyword">try</span>:
    response=request.urlopen(<span class="hljs-string">'http://cuiqingcai.com/index.htm'</span>)
<span class="hljs-keyword">except</span> error.HTTPError <span class="hljs-keyword">as</span> e:  <span class="hljs-comment">#先捕获子类异常</span>
    print(e.reason,e.code,e.headers,sep=<span class="hljs-string">'\n'</span>)
<span class="hljs-keyword">except</span> error.URLError <span class="hljs-keyword">as</span> e:  <span class="hljs-comment">#再捕获父类异常</span>
    print(e.reason)
<span class="hljs-keyword">else</span>:
    print(<span class="hljs-string">'request successfully'</span>)</code></pre></div>

<h3 id="二：方法二：requests"><a href="#二：方法二：requests" class="headerlink" title="二：方法二：requests"></a>二：方法二：requests</h3><p>requests是python实现的简单易用的HTTP库，使用起来比urllib简洁很多。因为是第三方库，所以使用前需要cmd安装：<strong>pip install requests</strong></p>
<p>安装完成后import一下，正常则说明可以开始使用了。</p>
<h4 id="1-发起请求"><a href="#1-发起请求" class="headerlink" title="1.发起请求"></a>1.发起请求</h4><p>基本用法：<strong>requests.get()用于请求目标网站，类型是一个HTTPresponse类型</strong></p>
<div class="hljs"><pre><code class="hljs python"><span class="hljs-keyword">import</span> requests
url=<span class="hljs-string">"http://httpbin.org/get"</span>
data=&#123;<span class="hljs-string">"keywords"</span>:<span class="hljs-string">"itcast"</span>&#125;
headers=&#123;<span class="hljs-string">"User-Agent"</span>:<span class="hljs-string">"Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/78.0.3904.108 Safari/537.36"</span>&#125;
response = requests.get(url,headers=headers,params=data)
print(response.text)</code></pre></div>

<div class="hljs"><pre><code class="hljs python">&#123;
  <span class="hljs-string">"args"</span>: &#123;
    <span class="hljs-string">"keywords"</span>: <span class="hljs-string">"itcast"</span>
  &#125;, 
  <span class="hljs-string">"headers"</span>: &#123;
    <span class="hljs-string">"Accept"</span>: <span class="hljs-string">"*/*"</span>, 
    <span class="hljs-string">"Accept-Encoding"</span>: <span class="hljs-string">"gzip, deflate"</span>, 
    <span class="hljs-string">"Host"</span>: <span class="hljs-string">"httpbin.org"</span>, 
    <span class="hljs-string">"User-Agent"</span>: <span class="hljs-string">"Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/78.0.3904.108 Safari/537.36"</span>
  &#125;, 
  <span class="hljs-string">"origin"</span>: <span class="hljs-string">"118.123.252.136, 118.123.252.136"</span>, 
  <span class="hljs-string">"url"</span>: <span class="hljs-string">"https://httpbin.org/get?keywords=itcast"</span>
&#125;</code></pre></div>

<p>还可以将参数放在url中发送get请求</p>
<div class="hljs"><pre><code class="hljs python"><span class="hljs-keyword">import</span> requests

response = requests.get(http://httpbin.org/get?name=gemey&amp;age=22)
print(response.text)</code></pre></div>

<p>除了提出get请求，还可以发出以下几个请求：</p>
<div class="hljs"><pre><code class="hljs python">requests.get(<span class="hljs-string">'http://httpbin.org/get'</span>)
requests.post(<span class="hljs-string">'http://httpbin.org/post'</span>)
requests.put(<span class="hljs-string">'http://httpbin.org/put'</span>)
requests.delete(<span class="hljs-string">'http://httpbin.org/delete'</span>)
requests.head(<span class="hljs-string">'http://httpbin.org/get'</span>)
requests.options(<span class="hljs-string">'http://httpbin.org/get'</span>)</code></pre></div>

<h4 id="2-带参数的请求"><a href="#2-带参数的请求" class="headerlink" title="2.带参数的请求"></a>2.带参数的请求</h4><p><strong>1.URL参数</strong></p>
<p>使用方法：</p>
<div class="hljs"><pre><code class="hljs python">requests.get(url,params=&#123;<span class="hljs-string">'key1'</span>:<span class="hljs-string">'value1'</span>&#125;,proxies=proxy)</code></pre></div>

<p><strong>2.表单参数提交</strong></p>
<p>Content-Type:application.x-www-form-urlencoded <em>(表单默认的提交数据格式)</em></p>
<p>内容：key1=value1&amp;key2=value2</p>
<div class="hljs"><pre><code class="hljs python">requests.post(url,data=&#123;<span class="hljs-string">'key1'</span>:<span class="hljs-string">'value1'</span>,<span class="hljs-string">'key2'</span>:<span class="hljs-string">'value2'</span>&#125;,proxies=proxy)</code></pre></div>

<p><strong>3.json参数提交</strong></p>
<p>Content-Type: appliction/json <em>(json数据格式)</em></p>
<p>内容：’{“key”:”value1”,”key2”:”value2”}’</p>
<div class="hljs"><pre><code class="hljs python">requests.post(url,json=&#123;<span class="hljs-string">'key1'</span>:<span class="hljs-string">'value1'</span>,<span class="hljs-string">'key2'</span>:<span class="hljs-string">'value2'</span>&#125;,proxies=proxy)</code></pre></div>

<h4 id="3-Response对象"><a href="#3-Response对象" class="headerlink" title="3.Response对象"></a>3.Response对象</h4><div class="hljs"><pre><code class="hljs python"><span class="hljs-keyword">import</span> requests

response = requests.get(<span class="hljs-string">'http://www.baidu.com'</span>)
print(response.status_code)  <span class="hljs-comment"># 打印状态码</span>
print(response.url)          <span class="hljs-comment"># 打印请求url</span>
print(response.headers)      <span class="hljs-comment"># 打印头信息</span>
print(response.cookies)      <span class="hljs-comment"># 打印cookie信息</span>
print(response.text)  <span class="hljs-comment">#以文本形式打印网页源码</span>
print(response.content) <span class="hljs-comment">#以字节流形式打印</span></code></pre></div>

<h4 id="4-异常捕获"><a href="#4-异常捕获" class="headerlink" title="4.异常捕获"></a>4.异常捕获</h4><p>在你不确定会发生什么错误时，尽量使用try…except来捕获异常。所有的requests.exception：</p>
<div class="hljs"><pre><code class="hljs python"><span class="hljs-keyword">import</span> requests
<span class="hljs-keyword">from</span> requests.exceptions <span class="hljs-keyword">import</span> ReadTimeout,HTTPError,RequestException

<span class="hljs-keyword">try</span>:
    response = requests.get(<span class="hljs-string">'http://www.baidu.com'</span>,timeout=<span class="hljs-number">0.5</span>)
    print(response.status_code)
<span class="hljs-keyword">except</span> ReadTimeout:
    print(<span class="hljs-string">'timeout'</span>)
<span class="hljs-keyword">except</span> HTTPError:
    print(<span class="hljs-string">'httperror'</span>)
<span class="hljs-keyword">except</span> RequestException:
    print(<span class="hljs-string">'reqerror'</span>)</code></pre></div>

<p> requests库将常见的http错误打了一个包，就是exceptions，通过使用exceptions可以处理项目中各种异常 </p>
<div class="hljs"><pre><code class="hljs python">RequestException:
HTTPError(RequestException) 　
UnrewindableBodyError(RequestException) 　
RetryError(RequestException) 　
ConnectionError(RequestException) ProxyError(ConnectionError)
SSLError(ConnectionError)
ConnectTimeout(ConnectionError, Timeout)
Timeout(RequestException) ReadTimeout
URLRequired(RequestException) 　
TooManyRedirects(RequestException) 　
MissingSchema(RequestException, ValueError) 　
InvalidSchema(RequestException,ValueError) 　
InvalidURL(RequestException,ValueError) 　
InvalidHeader(RequestException,ValueError) 　
ChunkedEncodingError(RequestException) 　
StreamConsumedError(RequestException,TypeError) 　
ContentDecodingError(RequestException,BaseHTTPError)</code></pre></div>

<h3 id="综合案例"><a href="#综合案例" class="headerlink" title="综合案例"></a>综合案例</h3><img src="/2020/07/22/%E8%A7%A3%E6%9E%90%E7%88%AC%E8%99%AB/image-20191205102155060.png" srcset="/img/loading.gif" alt="image-20191205102155060" style="zoom:67%;">

<p>爬取“沈阳化工大学”贴吧的帖子回复数，主题和发帖人的信息</p>
<p>分析url地址：</p>
<div class="hljs"><pre><code class="hljs python">http://tieba.baidu.com/f?kw=xxx&amp;ie=utf-8&amp;pn=0 #第一页的内容
http://tieba.baidu.com/f?kw=xxx&amp;ie=utf-8&amp;pn=50 #第二页的内容
http://tieba.baidu.com/f?kw=xxx&amp;ie=utf-8&amp;pn=100 #第三页的内容</code></pre></div>

<p>下面使用两种方法进行页面信息的爬取</p>
<h4 id="1-使用requests方法"><a href="#1-使用requests方法" class="headerlink" title="1.使用requests方法"></a>1.使用requests方法</h4><div class="hljs"><pre><code class="hljs python"><span class="hljs-keyword">import</span> requests
<span class="hljs-keyword">from</span> lxml <span class="hljs-keyword">import</span> etree <span class="hljs-keyword">as</span> et
<span class="hljs-keyword">import</span> json

<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">WebSpider</span><span class="hljs-params">(object)</span>:</span>
    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">__init__</span><span class="hljs-params">(self)</span>:</span>
        self.keyword=input(<span class="hljs-string">"输入要爬取的贴吧名："</span>)
        self.start_page=int(input(<span class="hljs-string">"输入起始页码："</span>))
        self.end_page=int(input(<span class="hljs-string">"输入结束页码："</span>))
        self.base_url=<span class="hljs-string">"http://tieba.baidu.com/"</span>
        
    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">load_page</span><span class="hljs-params">(self)</span>:</span>
        user_agent=<span class="hljs-string">"Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/78.0.3904.108 Safari/537.36"</span>
        header=&#123;<span class="hljs-string">"User-Agent"</span>:user_agent&#125;
        <span class="hljs-keyword">for</span> page <span class="hljs-keyword">in</span> range(self.start_page,self.end_page+<span class="hljs-number">1</span>):
            <span class="hljs-comment">#newkeyword=bytes(self.keyword).encode('utf-8')</span>
            new_url=self.base_url+<span class="hljs-string">"f?kw="</span>+self.keyword+<span class="hljs-string">"&amp;ie=utf-8&amp;pn="</span>+str((page<span class="hljs-number">-1</span>)*<span class="hljs-number">50</span>)
            print(new_url)
            response = requests.get(new_url,headers=header)
            self.parse_page(response.text)
            
    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">parse_page</span><span class="hljs-params">(self,html)</span>:</span>
        html_new=html.replace(<span class="hljs-string">r'&lt;!--'</span>,<span class="hljs-string">'"'</span>).replace(<span class="hljs-string">r'--&gt;'</span>,<span class="hljs-string">'"'</span>)
        root=et.HTML(html_new)
        replynum=root.xpath(<span class="hljs-string">"//ul[@id='thread_list']/li/div/div[1]//span/text()"</span>)
        title=root.xpath(<span class="hljs-string">"//ul[@id='thread_list']/li/div//a[@class='j_th_tit ']/text()"</span>)
        <span class="hljs-comment">#//ul[@id='thread_list']/li/div/div[2]/div[2]/div[1]/div/text()</span>
        url=root.xpath(<span class="hljs-string">"//ul[@id='thread_list']/li/div//a[@class='j_th_tit ']/@href"</span>)
        author=root.xpath(<span class="hljs-string">"//ul[@id='thread_list']/li/div/div[2]/div[1]/div[2]/span[1]/@title"</span>)
        self.append_page(replynum,title,url,author)
        
    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">append_page</span><span class="hljs-params">(self,replynum,title,url,author)</span>:</span>
        minsize=min(len(replynum),len(title),len(url),len(author))
        items=[]
        <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> range(minsize):
            item=&#123;&#125;
            item[<span class="hljs-string">"回复人数"</span>]=replynum[i]
            item[<span class="hljs-string">"帖子题目"</span>]=title[i]
            item[<span class="hljs-string">"帖子链接"</span>]=self.base_url+url[i]
            item[<span class="hljs-string">"作者"</span>]=author[i]
            items.append(item)
        self.save_json(items)
    
    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">save_json</span><span class="hljs-params">(self,items)</span>:</span>
        <span class="hljs-keyword">try</span>:
            <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> range(len(items)):
                strr = json.dumps(items[i],ensure_ascii=<span class="hljs-literal">False</span>)
                ff = open(self.keyword+<span class="hljs-string">".json"</span>,<span class="hljs-string">"a"</span>,encoding=<span class="hljs-string">'utf-8'</span>)
                ff.write(strr)
                ff.write(<span class="hljs-string">"\n\n"</span>)
                ff.close()
            print(<span class="hljs-string">"保存完毕"</span>)
        <span class="hljs-keyword">except</span> Exception <span class="hljs-keyword">as</span> ex:
            print(<span class="hljs-string">"保存失败"</span>)
            print(ex)
            
<span class="hljs-keyword">if</span> __name__==<span class="hljs-string">"__main__"</span>:
    spider = WebSpider()
    spider.load_page()</code></pre></div>

<img src="/2020/07/22/%E8%A7%A3%E6%9E%90%E7%88%AC%E8%99%AB/image-20191205211731504.png" srcset="/img/loading.gif" alt="image-20191205102155060">

<h4 id="2-使用urllib方法"><a href="#2-使用urllib方法" class="headerlink" title="2.使用urllib方法"></a>2.使用urllib方法</h4><p>代码主体与上面的一样，下面只列出不同的函数</p>
<div class="hljs"><pre><code class="hljs python"><span class="hljs-keyword">import</span> urllib.request
<span class="hljs-keyword">import</span> urllib.parse
<span class="hljs-keyword">from</span> lxml <span class="hljs-keyword">import</span> etree <span class="hljs-keyword">as</span> et
<span class="hljs-keyword">import</span> json

<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">load_page</span><span class="hljs-params">(self)</span>:</span>
        user_agent=<span class="hljs-string">"Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/78.0.3904.108 Safari/537.36"</span>
        header=&#123;<span class="hljs-string">"User-Agent"</span>:user_agent&#125;
        <span class="hljs-keyword">for</span> page <span class="hljs-keyword">in</span> range(self.start_page,self.end_page+<span class="hljs-number">1</span>):
            new_url=self.base_url+<span class="hljs-string">"f?kw="</span>+self.keyword+<span class="hljs-string">"&amp;ie=utf-8&amp;pn="</span>+str((page<span class="hljs-number">-1</span>)*<span class="hljs-number">50</span>)
            print(new_url)
            response = urllib.request.urlopen(urllib.request.Request(new_url,headers=header))
            self.parse_page(response.read().decode(<span class="hljs-string">"utf-8"</span>))</code></pre></div>



<h2 id="（二）爬取动态内容"><a href="#（二）爬取动态内容" class="headerlink" title="（二）爬取动态内容"></a>（二）爬取动态内容</h2><p>提前安装好Selenium+chromedriver</p>
<h3 id="一：入门操作"><a href="#一：入门操作" class="headerlink" title="一：入门操作"></a>一：入门操作</h3><p>通常所有的操作与页面交互都将通过WebElement接口，常见的操作元素方法如下：</p>
<div class="hljs"><pre><code class="hljs python">clear() <span class="hljs-comment">#清除元素的内容</span>
send_keys() <span class="hljs-comment">#模拟按键输入</span>
click() <span class="hljs-comment">#点击元素</span>
submit() <span class="hljs-comment">#提交表单</span></code></pre></div>

<p>通过WebElement接口可以获取常用的值，这些值同样非常重要。</p>
<div class="hljs"><pre><code class="hljs python">size <span class="hljs-comment">#获取元素的尺寸</span>
text <span class="hljs-comment">#获取元素的文本  !!!</span>
get_attribute(name) <span class="hljs-comment">#获取属性值  !!!!!!</span>
location <span class="hljs-comment">#获取元素坐标，先找到要获取的元素，再调用该方法</span>
page_source <span class="hljs-comment">#返回页面源码  !!!</span>
driver.title <span class="hljs-comment">#返回页面标题 !!!</span>
current_url <span class="hljs-comment">#获取当前页面的URL  !!!</span>
is_displayed() <span class="hljs-comment">#设置该元素是否可见</span>
is_enabled() <span class="hljs-comment">#判断元素是否被使用</span>
is_selected() <span class="hljs-comment">#判断元素是否被选中</span>
tag_name <span class="hljs-comment">#返回元素的tagName</span></code></pre></div>

<p>下面一次进行演示:</p>
<h4 id="1-打开页面"><a href="#1-打开页面" class="headerlink" title="1.打开页面"></a>1.打开页面</h4><div class="hljs"><pre><code class="hljs python"><span class="hljs-keyword">from</span> selenium <span class="hljs-keyword">import</span> webdriver

browser=webdriver.Chrome()
<span class="hljs-comment">#获取页面</span>
browser.get(<span class="hljs-string">"http://baidu.com/"</span>)</code></pre></div>

<p>这一步执行完会自动打开一个浏览器，浏览器中打开相应的百度页面，如果出现data;，这样的Tab，那么说明你的chrome浏览器和chromedriver的版本不一致造成的。</p>
<h4 id="2-获取页面名为wrapper的id标签的文本内容"><a href="#2-获取页面名为wrapper的id标签的文本内容" class="headerlink" title="2.获取页面名为wrapper的id标签的文本内容"></a>2.获取页面名为wrapper的id标签的文本内容</h4><div class="hljs"><pre><code class="hljs python">data=browser.find_element_by_id(<span class="hljs-string">"wrapper"</span>).text
print(data)</code></pre></div>

<h4 id="3-打印页面标题"><a href="#3-打印页面标题" class="headerlink" title="3.打印页面标题"></a>3.打印页面标题</h4><div class="hljs"><pre><code class="hljs python">print(browser.title)</code></pre></div>

<h4 id="4-打印页面源代码（浏览器执行完后的页面）"><a href="#4-打印页面源代码（浏览器执行完后的页面）" class="headerlink" title="4.打印页面源代码（浏览器执行完后的页面）"></a>4.打印页面源代码（浏览器执行完后的页面）</h4><div class="hljs"><pre><code class="hljs python">print(browser.page_source)</code></pre></div>

<h4 id="5-向表单添加内容，并进行搜索，截图"><a href="#5-向表单添加内容，并进行搜索，截图" class="headerlink" title="5.向表单添加内容，并进行搜索，截图"></a>5.向表单添加内容，并进行搜索，截图</h4><div class="hljs"><pre><code class="hljs python"><span class="hljs-keyword">from</span> selenium.webdriver.common.keys <span class="hljs-keyword">import</span> Keys
<span class="hljs-keyword">import</span> time

browser.get(<span class="hljs-string">"http://baidu.com/"</span>)
browser.find_element_by_id(<span class="hljs-string">"kw"</span>).send_keys(<span class="hljs-string">u"沈阳化工大学"</span>)
browser.find_element_by_id(<span class="hljs-string">"kw"</span>).send_keys(Keys.RETURN)
time.sleep(<span class="hljs-number">2</span>)
browser.save_screenshot(<span class="hljs-string">"baidu.png"</span>)</code></pre></div>

<p>send_keys()方法的作用就是往页面元素上添加内容。此时，再次打开baidu.png时，可以看到“长城”已经添加带百度页面的搜索框中，并截下图了。</p>
<h4 id="6-模拟点击页面上的按钮"><a href="#6-模拟点击页面上的按钮" class="headerlink" title="6.模拟点击页面上的按钮"></a>6.模拟点击页面上的按钮</h4><div class="hljs"><pre><code class="hljs python"><span class="hljs-keyword">import</span> time

browser.get(<span class="hljs-string">"http://baidu.com/"</span>)
browser.find_element_by_id(<span class="hljs-string">"kw"</span>).send_keys(<span class="hljs-string">u"沈阳化工大学"</span>)
browser.find_element_by_id(<span class="hljs-string">"su"</span>).click()
time.sleep(<span class="hljs-number">2</span>)
browser.save_screenshot(<span class="hljs-string">"baidu1.png"</span>)</code></pre></div>

<p>结果同上图一样</p>
<h4 id="7-调用键盘操作Keys包"><a href="#7-调用键盘操作Keys包" class="headerlink" title="7.调用键盘操作Keys包"></a>7.调用键盘操作Keys包</h4><p> 前面讲述了鼠标操作，现在讲述键盘操作。在webdriver的Keys类中提供了键盘所有的按键操作，当然也包括一些常见的组合键操作如Ctrl+A(全选)、Ctrl+C(复制)、Ctrl+V(粘贴)。更多键参考官方文档对应的编码。</p>
<div class="hljs"><pre><code class="hljs python">send_keys(Keys.ENTER) <span class="hljs-comment">#按下回车键</span>
send_keys(Keys.TAB) <span class="hljs-comment">#按下Tab制表键</span>
send_keys(Keys.SPACE) <span class="hljs-comment">#按下空格键space</span>
send_keys(Kyes.ESCAPE) <span class="hljs-comment">#按下回退键Esc</span>
send_keys(Keys.BACK_SPACE) <span class="hljs-comment">#按下删除键BackSpace</span>
send_keys(Keys.SHIFT) <span class="hljs-comment">#按下shift键</span>
send_keys(Keys.CONTROL) <span class="hljs-comment">#按下Ctrl键</span>
send_keys(Keys.ARROW_DOWN) <span class="hljs-comment">#按下鼠标光标向下按键</span>
send_keys(Keys.CONTROL,<span class="hljs-string">'a'</span>) <span class="hljs-comment">#组合键全选Ctrl``+``A</span>
send_keys(Keys.CONTROL,<span class="hljs-string">'c'</span>) <span class="hljs-comment">#组合键复制Ctrl``+``C</span>
send_keys(Keys.CONTROL,<span class="hljs-string">'x'</span>) <span class="hljs-comment">#组合键剪切Ctrl``+``X</span>
send_keys(Keys.CONTROL,<span class="hljs-string">'v'</span>) <span class="hljs-comment">#组合键粘贴Ctrl``+``V</span></code></pre></div>

<div class="hljs"><pre><code class="hljs python"><span class="hljs-keyword">from</span> selenium.webdriver.common.keys <span class="hljs-keyword">import</span> Keys</code></pre></div>

<h5 id="通过模拟【Ctrl-A】键全选输入框内容"><a href="#通过模拟【Ctrl-A】键全选输入框内容" class="headerlink" title="通过模拟【Ctrl+A】键全选输入框内容"></a>通过模拟【Ctrl+A】键全选输入框内容</h5><div class="hljs"><pre><code class="hljs python">browser.find_element_by_id(<span class="hljs-string">"kw"</span>).send_keys(Keys.CONTROL,<span class="hljs-string">'a'</span>)</code></pre></div>

<h5 id="通过模拟【Ctrl-C】键复制输入框内容"><a href="#通过模拟【Ctrl-C】键复制输入框内容" class="headerlink" title="通过模拟【Ctrl+C】键复制输入框内容"></a>通过模拟【Ctrl+C】键复制输入框内容</h5><div class="hljs"><pre><code class="hljs python">browser.find_element_by_id(<span class="hljs-string">"kw"</span>).send_keys(Keys.CONTROL,<span class="hljs-string">'c'</span>)</code></pre></div>

<h5 id="通过模拟【Enter】键复制输入框内容"><a href="#通过模拟【Enter】键复制输入框内容" class="headerlink" title="通过模拟【Enter】键复制输入框内容"></a>通过模拟【Enter】键复制输入框内容</h5><div class="hljs"><pre><code class="hljs python">browser.find_element_by_id(<span class="hljs-string">"kw"</span>).send_keys(<span class="hljs-string">u"沈阳化工大学"</span>)
browser.find_element_by_id(<span class="hljs-string">"kw"</span>).send_keys(Keys.RETURN)</code></pre></div>

<h4 id="8-清除输入框内容"><a href="#8-清除输入框内容" class="headerlink" title="8.清除输入框内容"></a>8.清除输入框内容</h4><div class="hljs"><pre><code class="hljs python">browser.find_element_by_id(<span class="hljs-string">"kw"</span>).clear()</code></pre></div>

<h4 id="9-提交表单"><a href="#9-提交表单" class="headerlink" title="9.提交表单"></a>9.提交表单</h4><div class="hljs"><pre><code class="hljs python">driver.find_element_by_id(<span class="hljs-string">"loginBtn"</span>).click()
driver.find_element_by_id(<span class="hljs-string">"loginBtn"</span>).submit()</code></pre></div>

<h4 id="10-获取当前页面的Cookie"><a href="#10-获取当前页面的Cookie" class="headerlink" title="10.获取当前页面的Cookie"></a>10.获取当前页面的Cookie</h4><div class="hljs"><pre><code class="hljs python">browser.get_cookies()</code></pre></div>

<h4 id="11-获取当前URL"><a href="#11-获取当前URL" class="headerlink" title="11.获取当前URL"></a>11.获取当前URL</h4><div class="hljs"><pre><code class="hljs css"><span class="hljs-selector-tag">browser</span><span class="hljs-selector-class">.current_url</span></code></pre></div>

<h4 id="12-关闭"><a href="#12-关闭" class="headerlink" title="12.关闭"></a>12.关闭</h4><div class="hljs"><pre><code class="hljs python">browser.close()<span class="hljs-comment">#关闭当前页面，如果只有一个页面，关闭浏览器</span>
browser.quit()<span class="hljs-comment">#关闭浏览器</span></code></pre></div>

<h3 id="二-定位UI元素"><a href="#二-定位UI元素" class="headerlink" title="二:定位UI元素"></a>二:定位UI元素</h3><p>这里有各种策略用于定位网页中的元素(locate elements)，你可以选择最适合的方案，Selenium提供了一下方法来定义一个页面中的元素：</p>
<h4 id="1-查找单个元素"><a href="#1-查找单个元素" class="headerlink" title="1.查找单个元素"></a>1.查找单个元素</h4><div class="hljs"><pre><code class="hljs python">find_element_by_id
find_element_by_name
find_element_by_xpath
find_element_by_link_text <span class="hljs-comment">#根据链接文本定位到页面元素</span>
find_element_by_partial_link_text<span class="hljs-comment">#根据部分链接文本定位到页面元素</span>
find_element_by_tag_name
find_element_by_class_name
find_element_by_css_selector<span class="hljs-comment">#在这个函数中写选择器语句，比如：“#food span.dairy.aged”</span></code></pre></div>

<h4 id="2-查找多个元素"><a href="#2-查找多个元素" class="headerlink" title="2.查找多个元素"></a>2.查找多个元素</h4><p> 下面是查找多个元素（这些方法将返回一个列表）：</p>
<div class="hljs"><pre><code class="hljs python">find_elements_by_name
find_elements_by_xpath
find_elements_by_link_text
find_elements_by_partial_link_text
find_elements_by_tag_name
find_elements_by_class_name
find_elements_by_css_selector</code></pre></div>

<h4 id="3-示例"><a href="#3-示例" class="headerlink" title="3.示例"></a>3.示例</h4><p>常用方法是通过xpath相对路径进行定位，同时CSS也是比较好的方法。举例：</p>
<div class="hljs"><pre><code class="hljs HTML"><span class="hljs-tag">&lt;<span class="hljs-name">html</span>&gt;</span>
 <span class="hljs-tag">&lt;<span class="hljs-name">body</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">form</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"loginForm"</span>&gt;</span>
   <span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"username"</span> <span class="hljs-attr">type</span>=<span class="hljs-string">"text"</span> /&gt;</span>
   <span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"password"</span> <span class="hljs-attr">type</span>=<span class="hljs-string">"password"</span> /&gt;</span>
   <span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"continue"</span> <span class="hljs-attr">type</span>=<span class="hljs-string">"submit"</span> <span class="hljs-attr">value</span>=<span class="hljs-string">"Login"</span> /&gt;</span>
   <span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"continue"</span> <span class="hljs-attr">type</span>=<span class="hljs-string">"button"</span> <span class="hljs-attr">value</span>=<span class="hljs-string">"Clear"</span> /&gt;</span>
  <span class="hljs-tag">&lt;/<span class="hljs-name">form</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">body</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">html</span>&gt;</span></code></pre></div>

<p>定位username元素的方法如下：</p>
<div class="hljs"><pre><code class="hljs python">username = driver.find_element_by_xpath(<span class="hljs-string">"//form[input/@name='username']"</span>)
username = driver.find_element_by_xpath(<span class="hljs-string">"//form[@id='loginForm']/input[1]"</span>)
username = driver.find_element_by_xpath(<span class="hljs-string">"//input[@name='username']"</span>)</code></pre></div>

<p>​    [1] 第一个form元素通过一个input子元素，name属性和值为username实现<br>​    [2] 通过id=loginForm值的form元素找到第一个input子元素<br>​    [3] 属性名为name且值为username的第一个input元素</p>
<h3 id="三-鼠标操作"><a href="#三-鼠标操作" class="headerlink" title="三:鼠标操作"></a>三:鼠标操作</h3><p>在现实的自动化测试中关于鼠标的操作不仅仅是click()单击操作，还有很多包含在<em>ActionChains类</em>中的操作。如下：</p>
<div class="hljs"><pre><code class="hljs python">click(elem) <span class="hljs-comment">#鼠标点击元素elem</span>
context_click(elem) <span class="hljs-comment">#右击鼠标点击元素elem，另存为等行为</span>
double_click(elem) <span class="hljs-comment">#双击鼠标点击元素elem，地图web可实现放大功能</span>
drag_and_drop(source,target) <span class="hljs-comment">#拖动鼠标，源元素按下左键移动至目标元素释放</span>
move_to_element(elem) <span class="hljs-comment">#鼠标移动到一个元素上</span>
click_and_hold(elem) <span class="hljs-comment">#按下鼠标左键在一个元素上并保持住</span>
perform() <span class="hljs-comment">#在通过调用该函数执行ActionChains中存储行为</span></code></pre></div>

<p>举例如下图所示，获取通过鼠标右键另存为百度图片logo。代码：</p>
<div class="hljs"><pre><code class="hljs python"><span class="hljs-keyword">import</span> time
<span class="hljs-keyword">from</span> selenium <span class="hljs-keyword">import</span> webdriver
<span class="hljs-keyword">from</span> selenium.webdriver.common.keys <span class="hljs-keyword">import</span> Keys
<span class="hljs-keyword">from</span> selenium.webdriver.common.action_chains <span class="hljs-keyword">import</span> ActionChains

driver = webdriver.Chrome()
driver.get(<span class="hljs-string">"http://www.baidu.com"</span>)

<span class="hljs-comment">#鼠标移动至图片上 右键保存图片</span>
elem_pic = driver.find_element_by_xpath(<span class="hljs-string">"//div[@id='lg']/img[1]"</span>)
print(elem_pic.get_attribute(<span class="hljs-string">"src"</span>))
action = ActionChains(driver).move_to_element(elem_pic).context_click(elem_pic)

<span class="hljs-comment">#重点:当右键鼠标点击键盘光标向下则移动至右键菜单第一个选项</span>
action.send_keys(Keys.ARROW_DOWN)
time.sleep(<span class="hljs-number">3</span>)
action.send_keys(<span class="hljs-string">'v'</span>) <span class="hljs-comment">#另存为</span>
action.perform()</code></pre></div>

<h3 id="四-填充表单"><a href="#四-填充表单" class="headerlink" title="四:填充表单"></a>四:填充表单</h3><p>对于下拉菜单（Select）的操作，Selenium有专门的类Select进行处理。</p>
<p>页面HTML源码如下所示：</p>
<select id="nr" name="NR">
<option value="10" selected>每页显示10条</option>
<option value="20">每页显示20条</option>
<option value="50">每页显示50条</option>
</select>

<h4 id="1-Select提供了三种选择方法："><a href="#1-Select提供了三种选择方法：" class="headerlink" title="1.Select提供了三种选择方法："></a>1.Select提供了三种选择方法：</h4><div class="hljs"><pre><code class="hljs python">select_by_index(index) <span class="hljs-comment">#通过选项的顺序，第一个为 0</span>
select_by_value(value) <span class="hljs-comment">#通过value属性</span>
select_by_visible_text(text) <span class="hljs-comment">#通过选项可见文本</span></code></pre></div>

<h4 id="2-Select提供了四种方法取消选择："><a href="#2-Select提供了四种方法取消选择：" class="headerlink" title="2.Select提供了四种方法取消选择："></a>2.Select提供了四种方法取消选择：</h4><div class="hljs"><pre><code class="hljs python">deselect_by_index(index)
deselect_by_value(value)
deselect_by_visible_text(text)
deselect_all()</code></pre></div>

<h4 id="3-Select提供了三个属性方法提供信息："><a href="#3-Select提供了三个属性方法提供信息：" class="headerlink" title="3.Select提供了三个属性方法提供信息："></a>3.Select提供了三个属性方法提供信息：</h4><div class="hljs"><pre><code class="hljs python">options <span class="hljs-comment">#提供所有的选项的列表，其中都是选项的WebElement元素</span>
all_selected_options <span class="hljs-comment">#提供所有被选中的选项的列表，其中也均为选项的WebElement元素</span>
first_selected_option <span class="hljs-comment">#提供第一个被选中的选项，也是下拉框的默认值</span></code></pre></div>

<p>通过Select提供的方法和属性，我们可以对标准select下拉框进行任何操作，但是对于非select标签的伪下拉框，需要使用XPath定位；</p>
<h4 id="4-示例"><a href="#4-示例" class="headerlink" title="4.示例"></a>4.示例</h4><div class="hljs"><pre><code class="hljs python"><span class="hljs-keyword">from</span> selenium <span class="hljs-keyword">import</span> webdriver
<span class="hljs-keyword">from</span> selenium.webdriver.common.action_chains <span class="hljs-keyword">import</span> ActionChains
<span class="hljs-keyword">from</span> selenium.webdriver.support.select <span class="hljs-keyword">import</span> Select
<span class="hljs-keyword">import</span> time
 
driver = webdriver.Chrome()
driver.get(<span class="hljs-string">"https://www.baidu.com/"</span>)
driver.implicitly_wait(<span class="hljs-number">20</span>)
 
mouse = driver.find_element_by_link_text(<span class="hljs-string">"设置"</span>)
ActionChains(driver).move_to_element(mouse).perform()
driver.find_element_by_link_text(<span class="hljs-string">"搜索设置"</span>).click()
time.sleep(<span class="hljs-number">2</span>)
<span class="hljs-comment"># 实例化select</span>
s = Select(driver.find_element_by_id(<span class="hljs-string">"nr"</span>))
<span class="hljs-comment"># 定位选项</span>
s.select_by_value(<span class="hljs-string">"20"</span>)  <span class="hljs-comment"># 选择value="20"的项：通过value属性</span>
time.sleep(<span class="hljs-number">2</span>)   <span class="hljs-comment">#为了明显的看出变化</span>
s.select_by_index(<span class="hljs-number">0</span>)  <span class="hljs-comment"># 选择第一项选项：通过选项的顺序选择，第一个为 0</span>
time.sleep(<span class="hljs-number">2</span>)   <span class="hljs-comment">#为了明显的看出变化</span>
s.select_by_visible_text(<span class="hljs-string">"每页显示50条"</span>)  <span class="hljs-comment"># 选择text="每页显示50条"的值，即在下拉时我们可以看到的文本</span></code></pre></div>

<h3 id="五-弹窗处理"><a href="#五-弹窗处理" class="headerlink" title="五:弹窗处理"></a>五:弹窗处理</h3><p>弹出框有两种：页面弹出框（可定位元素能操作）、Windows弹出框（不能直接定位）</p>
<h4 id="1-页面弹出框"><a href="#1-页面弹出框" class="headerlink" title="1.页面弹出框"></a><strong>1.页面弹出框</strong></h4><p>等待弹出框出现之后，定位弹出框，操作其中元素</p>
<div class="hljs"><pre><code class="hljs python">driver = webdriver.Chrome()
driver.get(<span class="hljs-string">"https://www.baidu.com"</span>)
driver.maximize_window()
<span class="hljs-comment">#点击百度登录按钮</span>
driver.find_element_by_xpath(<span class="hljs-string">'//*[@id="u1"]//a[@name="tj_login"]'</span>).click()

<span class="hljs-comment">#等待百度登录弹出框中 要出现的元素可见</span>
ele_id = <span class="hljs-string">"TANGRAM__PSP_10__footerULoginBtn"</span>
param = (By.ID,ele_id)
<span class="hljs-comment">#元素可见时，再进行后续操作</span>
WebDriverWait(driver,<span class="hljs-number">10</span>).until(EC.visibility_of_element_located(param))

driver.find_element_by_id(ele_id).click()
time.sleep(<span class="hljs-number">5</span>)
driver.quit()</code></pre></div>

<h4 id="2-Windows弹出框"><a href="#2-Windows弹出框" class="headerlink" title="2.Windows弹出框"></a><strong>2.Windows弹出框</strong></h4><p>使用 driver.switch_to.alert 切换到Windows弹出框,Alert类提供了一系列操作方法：</p>
<div class="hljs"><pre><code class="hljs python">accept() <span class="hljs-comment">#确定</span>
dismiss() <span class="hljs-comment">#取消</span>
text() <span class="hljs-comment">#获取弹出框里面的内容</span>
send_keys(keysToSend) <span class="hljs-comment">#输入字符串</span></code></pre></div>

<div class="hljs"><pre><code class="hljs python"><span class="hljs-comment">#1:定位alert弹出框</span>
<span class="hljs-comment">#点击页面元素，触发alert弹出框</span>
driver.find_element_by_xpath(<span class="hljs-string">'//*[@id="alert"]'</span>).click()
time.sleep(<span class="hljs-number">3</span>)
<span class="hljs-comment">#等待alert弹出框可见</span>
WebDriverWait(driver,<span class="hljs-number">20</span>).until(EC.alert_is_present())

<span class="hljs-comment">#从html页面切换到alert弹框 </span>
alert = driver.switch_to.alert
<span class="hljs-comment">#获取alert的文本内容</span>
print(alert.text)
<span class="hljs-comment">#接受--选择“确定”</span>
alert.accept()

<span class="hljs-comment">#2:定位confirm弹出框</span>
driver.find_element_by_xpath(<span class="hljs-string">'//*[@id="confirm"]'</span>).click()
time.sleep(<span class="hljs-number">3</span>)
WebDriverWait(driver,<span class="hljs-number">20</span>).until(EC.alert_is_present())
alert =driver.switch_to.alert
print(alert.text)
<span class="hljs-comment"># 接受--选择“取消”</span>
alert.dismiss()


<span class="hljs-comment">#3:定位prompt弹出框</span>
driver.find_element_by_id(<span class="hljs-string">"prompt"</span>).click()
time.sleep(<span class="hljs-number">3</span>)
WebDriverWait(driver,<span class="hljs-number">20</span>).until(EC.alert_is_present())
alert =driver.switch_to.alert
alert.send_keys(<span class="hljs-string">"jaja"</span>)
time.sleep(<span class="hljs-number">5</span>)
print(alert.text)
<span class="hljs-comment"># alert.dismiss()</span>
alert.accept()</code></pre></div>

<h3 id="六-页面切换"><a href="#六-页面切换" class="headerlink" title="六:页面切换"></a>六:页面切换</h3><p>在打开新的浏览器窗口时，如果要定位新窗口的元素，需要先切换到这个新打开的窗口中，才能定位到该窗口下的元素。</p>
<h4 id="1-获取当前句柄"><a href="#1-获取当前句柄" class="headerlink" title="1.获取当前句柄"></a>1.获取当前句柄</h4><p>current_window_handle：获取当前句柄。可以把句柄理解成窗口的身份证</p>
<h4 id="2-获取所有打开窗口的句柄"><a href="#2-获取所有打开窗口的句柄" class="headerlink" title="2.获取所有打开窗口的句柄"></a>2.获取所有打开窗口的句柄</h4><p>window_handles：获取所有打开窗口的句柄</p>
<div class="hljs"><pre><code class="hljs python"><span class="hljs-keyword">from</span> selenium <span class="hljs-keyword">import</span> webdriver
<span class="hljs-keyword">import</span> time

dr = webdriver.Chrome()
dr.get(<span class="hljs-string">'https://www.baidu.com'</span>)
<span class="hljs-comment"># dr.maximize_window()</span>
win_handle = dr.current_window_handle<span class="hljs-comment">#获取当前窗口句柄</span>
print(win_handle)
js = <span class="hljs-string">'window.open("http://news.baidu.com")'</span><span class="hljs-comment">#js打开新窗口</span>
dr.execute_script(js)<span class="hljs-comment">#执行js</span>
handles = dr.window_handles<span class="hljs-comment">#获取所有窗口句柄</span>
<span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> handles:
    <span class="hljs-keyword">if</span> i != win_handle:<span class="hljs-comment">#如果句柄不是当前窗口的句柄</span>
        dr.switch_to.window(i)<span class="hljs-comment">#切换窗口</span>
ww = dr.find_element_by_id(<span class="hljs-string">'ww'</span>)<span class="hljs-comment">#新闻页面的搜索输入框</span>
ww.send_keys(<span class="hljs-string">'selenium'</span>)
time.sleep(<span class="hljs-number">2</span>)
dr.switch_to.window(win_handle)<span class="hljs-comment">#切换到百度首页的句柄</span>
tr = dr.find_element_by_id(<span class="hljs-string">'kw'</span>)<span class="hljs-comment">#百度首页搜索框</span>
tr.send_keys(<span class="hljs-string">'selenium'</span>)</code></pre></div>

<img src="/2020/07/22/%E8%A7%A3%E6%9E%90%E7%88%AC%E8%99%AB/70.jpg" srcset="/img/loading.gif" alt="i70.jpg">

<p>这是打印出来的句柄</p>
<p>因为使用WebDriver点击百度新闻不会新打开一个页面，所以就通过js来模拟打开一个新网页了。通过循环所有句柄，当句柄不是当前窗口的句柄，就切换到这个窗口去。</p>
<div class="hljs"><pre><code class="hljs python"><span class="hljs-keyword">from</span> selenium <span class="hljs-keyword">import</span> webdriver
<span class="hljs-keyword">import</span> time

dr = webdriver.Chrome()
dr.get(<span class="hljs-string">'https://www.baidu.com'</span>)
dr.maximize_window()
js = <span class="hljs-string">'window.open("http://news.baidu.com")'</span>
dr.execute_script(js)
handles = dr.window_handles<span class="hljs-comment">#获取所有窗口句柄</span>
dr.switch_to.window(handles[<span class="hljs-number">1</span>])
ww = dr.find_element_by_id(<span class="hljs-string">'ww'</span>)<span class="hljs-comment">#新闻页面的搜索输入框</span>
ww.send_keys(<span class="hljs-string">'selenium'</span>)
time.sleep(<span class="hljs-number">2</span>)
dr.switch_to.window(handles[<span class="hljs-number">0</span>])
tr = dr.find_element_by_id(<span class="hljs-string">'kw'</span>)<span class="hljs-comment">#百度首页搜索框</span>
tr.send_keys(<span class="hljs-string">'selenium'</span>)
dr.quit()</code></pre></div>

<p>所有窗口句柄是一个数组，可以通过数组的下标来访问相应的句柄，默认是按照打开窗口的顺序存的。</p>

            </div>
            <hr>
            <div>
              <div class="post-metas mb-3">
                
                  <div class="post-meta mr-3">
                    <i class="iconfont icon-category"></i>
                    
                      <a class="hover-with-bg" href="/categories/Python/">Python</a>
                    
                      <a class="hover-with-bg" href="/categories/Python/%E7%88%AC%E8%99%AB/">爬虫</a>
                    
                  </div>
                
                
                  <div class="post-meta">
                    <i class="iconfont icon-tags"></i>
                    
                      <a class="hover-with-bg" href="/tags/%E7%88%AC%E8%99%AB/">爬虫</a>
                    
                  </div>
                
              </div>
              
                <p class="note note-warning">本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-sa/4.0/deed.zh" target="_blank" rel="nofollow noopener noopener">CC BY-SA 4.0 协议</a> ，转载请注明出处！</p>
              
              
                <div class="post-prevnext row">
                  <article class="post-prev col-6">
                    
                    
                      <a href="/2020/07/22/Git%E5%9F%BA%E6%9C%AC%E5%91%BD%E4%BB%A4/">
                        <i class="iconfont icon-arrowleft"></i>
                        <span class="hidden-mobile">Git基本命令</span>
                        <span class="visible-mobile">上一篇</span>
                      </a>
                    
                  </article>
                  <article class="post-next col-6">
                    
                    
                      <a href="/2020/07/22/Numpy%E4%B8%AD%E7%9A%84%E9%AB%98%E7%BA%A7%E7%B4%A2%E5%BC%95/">
                        <span class="hidden-mobile">Numpy中的高级索引</span>
                        <span class="visible-mobile">下一篇</span>
                        <i class="iconfont icon-arrowright"></i>
                      </a>
                    
                  </article>
                </div>
              
            </div>

            
              <!-- Comments -->
              <article class="comments" id="comments">
                
                
  <div id="vcomments"></div>
  <script type="text/javascript">
    function loadValine() {
      addScript('https://cdn.staticfile.org/valine/1.4.14/Valine.min.js', function () {
        new Valine({
          el: "#vcomments",
          app_id: "6rS38oXgbqlO5KI3Wx39pRKE-gzGzoHsz",
          app_key: "jAT77piz4ukjWTMHISbSLW0x",
          placeholder: "说点什么",
          path: window.location.pathname,
          avatar: "retro",
          meta: ["nick","mail","link"],
          pageSize: "10",
          lang: "zh-CN",
          highlight: true,
          recordIP: false,
          serverURLs: "",
        });
      });
    }
    waitElementVisible('vcomments', loadValine);
  </script>
  <noscript>Please enable JavaScript to view the <a href="https://valine.js.org" target="_blank" rel="nofollow noopener noopener">comments
      powered by Valine.</a></noscript>


              </article>
            
          </article>
        </div>
      </div>
    </div>
    
      <div class="d-none d-lg-block col-lg-2 toc-container" id="toc-ctn">
        <div id="toc">
  <p class="toc-header"><i class="iconfont icon-list"></i>&nbsp;目录</p>
  <div id="tocbot"></div>
</div>

      </div>
    
  </div>
</div>

<!-- Custom -->


    
  </main>

  
    <a id="scroll-top-button" href="#" role="button">
      <i class="iconfont icon-arrowup" aria-hidden="true"></i>
    </a>
  

  
    <div class="modal fade" id="modalSearch" tabindex="-1" role="dialog" aria-labelledby="ModalLabel"
     aria-hidden="true">
  <div class="modal-dialog modal-dialog-scrollable modal-lg" role="document">
    <div class="modal-content">
      <div class="modal-header text-center">
        <h4 class="modal-title w-100 font-weight-bold">搜索</h4>
        <button type="button" id="local-search-close" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body mx-3">
        <div class="md-form mb-5">
          <input type="text" id="local-search-input" class="form-control validate">
          <label data-error="x" data-success="v"
                 for="local-search-input">关键词</label>
        </div>
        <div class="list-group" id="local-search-result"></div>
      </div>
    </div>
  </div>
</div>
  

  

  

  <footer class="mt-5">
  <div class="text-center py-3">
    <div>
      <a href="https://hexo.io" target="_blank" rel="nofollow noopener"><span>Hexo</span></a>
      <i class="iconfont icon-love"></i>
      <a href="https://github.com/fluid-dev/hexo-theme-fluid" target="_blank" rel="nofollow noopener">
        <span>Fluid</span></a>
    </div>
    
  <div class="statistics">
    
    

    
      
        <!-- 不蒜子统计PV -->
        <span id="busuanzi_container_site_pv" style="display: none">
            总访问量 
            <span id="busuanzi_value_site_pv"></span>
             次
          </span>
      
      
        <!-- 不蒜子统计UV -->
        <span id="busuanzi_container_site_uv" style="display: none">
            总访客数 
            <span id="busuanzi_value_site_uv"></span>
             人
          </span>
      
    
  </div>


    

    
  </div>
</footer>

<!-- SCRIPTS -->
<script  src="https://cdn.staticfile.org/jquery/3.4.1/jquery.min.js" ></script>
<script  src="https://cdn.staticfile.org/twitter-bootstrap/4.4.1/js/bootstrap.min.js" ></script>
<script  src="/js/debouncer.js" ></script>
<script  src="/js/main.js" ></script>

<!-- Plugins -->


  
    <script  src="/js/lazyload.js" ></script>
  



  



  <script defer src="https://cdn.staticfile.org/clipboard.js/2.0.6/clipboard.min.js" ></script>
  <script  src="/js/clipboard-use.js" ></script>



  <script defer src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js" ></script>





  <script  src="https://cdn.staticfile.org/tocbot/4.11.1/tocbot.min.js" ></script>
  <script>
    $(document).ready(function () {
      var boardCtn = $('#board-ctn');
      var boardTop = boardCtn.offset().top;

      tocbot.init({
        tocSelector: '#tocbot',
        contentSelector: '#post-body',
        headingSelector: 'h1,h2,h3,h4,h5,h6',
        linkClass: 'tocbot-link',
        activeLinkClass: 'tocbot-active-link',
        listClass: 'tocbot-list',
        isCollapsedClass: 'tocbot-is-collapsed',
        collapsibleClass: 'tocbot-is-collapsible',
        collapseDepth: 0,
        scrollSmooth: true,
        headingsOffset: -boardTop
      });
      if ($('.toc-list-item').length > 0) {
        $('#toc').css('visibility', 'visible');
      }
    });
  </script>



  <script  src="https://cdn.staticfile.org/typed.js/2.0.11/typed.min.js" ></script>
  <script>
    var typed = new Typed('#subtitle', {
      strings: [
        '  ',
        "Python网络爬虫基础知识&nbsp;",
      ],
      cursorChar: "_",
      typeSpeed: 200,
      loop: true,
    });
    typed.stop();
    $(document).ready(function () {
      $(".typed-cursor").addClass("h2");
      typed.start();
    });
  </script>



  <script  src="https://cdn.staticfile.org/anchor-js/4.2.2/anchor.min.js" ></script>
  <script>
    anchors.options = {
      placement: "right",
      visible: "hover",
      
    };
    var el = "h1,h2,h3,h4,h5,h6".split(",");
    var res = [];
    for (item of el) {
      res.push(".markdown-body > " + item)
    }
    anchors.add(res.join(", "))
  </script>



  <script  src="/js/local-search.js" ></script>
  <script>
    var path = "/local-search.xml";
    var inputArea = document.querySelector("#local-search-input");
    inputArea.onclick = function () {
      searchFunc(path, 'local-search-input', 'local-search-result');
      this.onclick = null
    }
  </script>



  <script  src="https://cdn.staticfile.org/fancybox/3.5.7/jquery.fancybox.min.js" ></script>
  <link  rel="stylesheet" href="https://cdn.staticfile.org/fancybox/3.5.7/jquery.fancybox.min.css" />

  <script>
    $('#post img:not(.no-zoom img, img[no-zoom]), img[zoom]').each(
      function () {
        var element = document.createElement('a');
        $(element).attr('data-fancybox', 'images');
        $(element).attr('href', $(this).attr('src'));
        $(this).wrap(element);
      }
    );
  </script>





  

  
    <!-- MathJax -->
    <script>
      MathJax = {
        tex: {
          inlineMath: [['$', '$'], ['\\(', '\\)']]
        },
        options: {
          renderActions: {
            findScript: [10, doc => {
              document.querySelectorAll('script[type^="math/tex"]').forEach(node => {
                const display = !!node.type.match(/; *mode=display/);
                const math = new doc.options.MathItem(node.textContent, doc.inputJax[0], display);
                const text = document.createTextNode('');
                node.parentNode.replaceChild(text, node);
                math.start = { node: text, delim: '', n: 0 };
                math.end = { node: text, delim: '', n: 0 };
                doc.math.push(math);
              });
            }, '', false],
            insertedScript: [200, () => {
              document.querySelectorAll('mjx-container').forEach(node => {
                let target = node.parentNode;
                if (target.nodeName.toLowerCase() === 'li') {
                  target.parentNode.classList.add('has-jax');
                }
              });
            }, '', false]
          }
        }
      };
    </script>

    <script async src="https://cdn.staticfile.org/mathjax/3.0.5/es5/tex-svg.js" ></script>

  



  
  
    <script>
      !function (e, t, a) {
        function r() {
          for (var e = 0; e < s.length; e++) s[e].alpha <= 0 ? (t.body.removeChild(s[e].el), s.splice(e, 1)) : (s[e].y--, s[e].scale += .004, s[e].alpha -= .013, s[e].el.style.cssText = "left:" + s[e].x + "px;top:" + s[e].y + "px;opacity:" + s[e].alpha + ";transform:scale(" + s[e].scale + "," + s[e].scale + ") rotate(45deg);background:" + s[e].color + ";z-index:99999");
          requestAnimationFrame(r)
        }

        function n() {
          var t = "function" == typeof e.onclick && e.onclick;
          e.onclick = function (e) {
            t && t(), o(e)
          }
        }

        function o(e) {
          var a = t.createElement("div");
          a.className = "heart", s.push({
            el: a,
            x: e.clientX - 5,
            y: e.clientY - 5,
            scale: 1,
            alpha: 1,
            color: c()
          }), t.body.appendChild(a)
        }

        function i(e) {
          var a = t.createElement("style");
          a.type = "text/css";
          try {
            a.appendChild(t.createTextNode(e))
          } catch (t) {
            a.styleSheet.cssText = e
          }
          t.getElementsByTagName("head")[0].appendChild(a)
        }

        function c() {
          return "rgb(" + ~~(255 * Math.random()) + "," + ~~(255 * Math.random()) + "," + ~~(255 * Math.random()) + ")"
        }

        var s = [];
        e.requestAnimationFrame = e.requestAnimationFrame || e.webkitRequestAnimationFrame || e.mozRequestAnimationFrame || e.oRequestAnimationFrame || e.msRequestAnimationFrame || function (e) {
          setTimeout(e, 1e3 / 60)
        }, i(".heart{width: 10px;height: 10px;position: fixed;background: #f00;transform: rotate(45deg);-webkit-transform: rotate(45deg);-moz-transform: rotate(45deg);}.heart:after,.heart:before{content: '';width: inherit;height: inherit;background: inherit;border-radius: 50%;-webkit-border-radius: 50%;-moz-border-radius: 50%;position: fixed;}.heart:after{top: -5px;}.heart:before{left: -5px;}"), n(), r()
      }(window, document);
    </script>
  














</body>
</html>
